# API "Фонд поддержки котиков QRKot"
Вымышленный благотворительный фонд поддержки котиков QRKot собирает пожертвования на всевозможные задачи, 
связанные с помощью кошачьей популяции: на корм, на медицинское обслуживание, 
организацию приютов и на другую помощь котам, кошкам и котятам.

В проекте реализована регистрация пользователей, персонализация пожертвований и разграничение прав доступа.

## Возможности API
- Благотворительные проекты (charity_projects)
  - Просмотреть список всех целевых проектов
    *(доступно всем пользователям, включая анонимных)*
  - Создать целевой проект
    *(только суперпользователи)*
  - Редактировать целевой проект 
    *(только суперпользователи)*
  - Удалить целевой проект 
    *(только суперпользователи)*
- Пожертвования (donations)
  - Просмотреть список всех пожертвований
    *(только суперпользователи)*
  - Создать пожертвование 
    *(только авторизованные пользователи)*
  - Просмотреть список своих пожертвований 
    *(только авторизованные пользователи)*
- Авторизация (auth)
  - Логин (получение JWT токена)
  - Logout 
    *(только авторизованные пользователи)*
  - Регистрация
- Пользователи (users)
  - Получить данные о текущем пользователе *(только авторизованные пользователи)*
  - Изменить данные текущего пользователя *(только авторизованные пользователи)*
  - Получить данные пользователя по id *(только суперпользователи)*
  - Обновить данные пользователя по id *(только суперпользователи)*
- Google
  - Формирование отчета в Google Sheets *(только суперпользователи)*

## Пользователям с любым уровнем доступа запрещено:
- Удалять пользователей,
- Редактировать или удалять пожертвования,
- Редактировать или удалять закрытые проекты,
- Удалять проекты, в которые инвестированы средства,
- Изменять даты создания и закрытия проектов.

## Установка и запуск локально
1. Склонируйте репозиторий:
```
git clone https://github.com/levinadev/QRkot_spreadsheets.git
cd QRkot_spreadsheets
```

2. Установите зависимости:
```
uv sync
```

3. Примените миграции:
```
alembic upgrade head
```

4. Запустите API:
```
uvicorn app.main:app --reload
```

5. После запуска документация доступна по адресу: http://localhost:8000/docs

6. Для остановки нажмите в консоли `CTRL+C`


## Примеры запросов:
1. Создать проект
- `POST /charity_project/`
```
{
  "name": "Новый дом для котиков",
  "description": "Строим большой дом для 20 котов",
  "full_amount": 5000
}
```

2. Получить все проекты
- `GET /charity_project/`

3. Обновить проект
- `PATCH /charity_project/{project_id}`
```
{
  "name": "Обновлённый проект",
  "full_amount": 8000
}
```

4. Удалить проект
- `DELETE /charity_project/{project_id}`

5. Создать пожертвование
- `POST /donation/`
```
{
  "full_amount": 2000,
  "comment": "От доброго человека"
}
```

6. Получить все пожертвования
- `GET /donation/all`

7. Получить пожертвование текущего пользователя
- `GET /donation/my`

8. Login
- `POST /auth/login`
```
{
  "username": "user@example.com",
  "password": "password123"
}
```

10. Logout
- `POST /auth/logout`
  - *(требуется передавать токен в заголовке Authorization: Bearer <token>)*

10. Регистрация
- `POST /auth/register`
```
{
  "email": "user@example.com",
  "password": "string",
  "is_active": true,
  "is_superuser": false,
  "is_verified": false
}
```

11. Получить данные о текущем пользователе
- `GET /users/me`

12. Изменить данные текущего пользователя
- `PATCH /users/me`
```
{
  "email": "updated@example.com"
}
```

14. Получить данные пользователя по id
- `GET /users/{user_id}`

15. Обновить данные пользователя по id
- `PATCH /users/{user_id}`
```
{
  "is_active": false
}
```

16. Сформировать отчет в Google Sheets
- `POST /google/`


## Технологии
- Python 3.9
- FastAPI
- FastAPI Users
- SQLAlchemy (async)
- Alembic
- Pydantic
- Uvicorn
- SQLite (aiosqlite)
- uv (менеджер зависимостей)


## Автор
- Имя: Анна
- Email: anna45dd@yandex.ru
- GitHub: https://github.com/levinadev